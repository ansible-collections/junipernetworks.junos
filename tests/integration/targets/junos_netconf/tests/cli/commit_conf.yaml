---
- ansible.builtin.debug:
    msg: START ios_cliconf integration tests on connection={{ ansible_connection }}

- name: Change hostname with commit_confirm_immediate
  vars:
    ansible_junos_commit_confirmed: true
    ansible_junos_commit_confirmed_timeout: 2
  junipernetworks.junos.junos_hostname:
    state: merged
    config:
      hostname: testConfirmCommitAppliance

- name: Verify hostname
  register: get_hostname
  junipernetworks.junos.junos_hostname:
    state: gathered

- name: Assert that the hostname is correctly set
  ansible.builtin.assert:
    that:
      - "'testConfirmCommitAppliance'  == in get_hostname.gathered.hostname"

- name: Verify hostname again
  register: get_hostname_again
  junipernetworks.junos.junos_hostname:
    state: gathered

- name: Assert that the hostname is not rolled back
  ansible.builtin.assert:
    that:
      - "'testAppliance' in get_hostname_again.stdout[0]"

- name: Verify and cleanup
  ansible.builtin.include_tasks: _cleanup.yam